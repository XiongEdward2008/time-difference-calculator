<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Time Difference Calculator</title>
    <style>
        /* 全局重置：解决旧内核 padding 计算问题 */
        * { box-sizing: border-box; -webkit-box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 0; 
            padding: 15px; /* 减小移动端边距 */
            background: #f0f2f5; 
            color: #333; 
            font-size: 16px; /* 防止 iOS 自动缩放输入框 */
        }

        .app { 
            display: flex; 
            gap: 20px; 
            max-width: 1000px; 
            margin: 0 auto; 
            align-items: flex-start; 
        }
        
        .input-section, .result-section { 
            flex: 1; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
            /* 关键：防止 flex 子元素被内容撑爆 */
            min-width: 0; 
        }

        .input-group { 
            margin-bottom: 15px; 
            display: flex; 
            align-items: center; 
            flex-wrap: wrap; /* 允许换行，防止挤压 */
        }
        
        label { 
            flex: 0 0 130px; /* 固定标签宽度 */
            text-align: right; 
            margin-right: 15px; 
            font-weight: 600; 
            color: #555;
            font-size: 14px;
        }
        
        /* 优化输入框样式 */
        select, input { 
            flex: 1; 
            min-width: 0; /* 关键：解决 Flex 布局下文字溢出问题 */
            width: 100%; /* 确保填满容器 */
            padding: 10px; 
            font-size: 15px; 
            border: 1px solid #ccc; 
            border-radius: 6px;
            background-color: #fff;
            
            /* 解决文字溢出样式 */
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
        }
        
        button { 
            padding: 12px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 6px;
            cursor: pointer; 
            width: 100%; 
            font-size: 16px; 
            font-weight: bold;
            margin-top: 10px;
            -webkit-appearance: none; /* 移除 iOS 默认按钮样式 */
        }
        
        #result { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; font-size: 14px; }
        
        .timeline {
            position: relative;
            width: 100%;
            height: 30px;
            background: #e9ecef;
            margin: 10px 0 5px 0;
            border-radius: 4px;
            overflow: hidden;
        }
        .timeline .free-my { position: absolute; height: 100%; background: #4facfe; opacity: 0.9; }
        .timeline .free-other { position: absolute; height: 100%; background: #ff758c; opacity: 0.9; }
        
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #888;
        }
        
        /* --- 针对移动设备的深度优化 --- */
        @media (max-width: 768px) {
            .app { 
                flex-direction: column; 
                gap: 15px; 
            }
            
            .input-section, .result-section {
                padding: 15px; /* 减小内边距 */
                width: 100%;
            }

            /* 强制改为上下结构，消除左右间隙 */
            .input-group { 
                display: block; 
                margin-bottom: 12px;
            }
            
            label { 
                display: block; 
                width: 100%; 
                text-align: left; 
                margin: 0 0 6px 0; /* 标签和输入框只留微小间距 */
                margin-right: 0;
            }
            
            select, input { 
                display: block;
                width: 100%; 
                max-width: none; /* 移除最大宽度限制 */
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="input-section">
            <h1 style="text-align: center; margin-bottom: 20px; font-size: 1.5em; color: #2c3e50;">Time Calculator</h1>
            
            <div class="input-group">
                <label for="myTimezone">Your Timezone:</label>
                <select id="myTimezone"></select>
            </div>
            
            <div class="input-group">
                <label for="myStart">Your Free Start:</label>
                <input type="time" id="myStart" value="09:00">
            </div>
            
            <div class="input-group">
                <label for="myEnd">Your Free End:</label>
                <input type="time" id="myEnd" value="23:00">
            </div>
            
            <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
            
            <div class="input-group">
                <label for="otherTimezone">Other's Timezone:</label>
                <select id="otherTimezone"></select>
            </div>
            
            <div class="input-group">
                <label for="otherStart">Other's Free Start:</label>
                <input type="time" id="otherStart" value="09:00">
            </div>
            
            <div class="input-group">
                <label for="otherEnd">Other's Free End:</label>
                <input type="time" id="otherEnd" value="23:00">
            </div>
            
            <button onclick="calculateOverlap()">Calculate Overlap</button>
        </div>
        
        <div class="result-section">
            <h2 style="text-align: center; margin-bottom: 15px; font-size: 1.3em; color: #2c3e50;">Results</h2>
            <div id="result">
                <p style="text-align: center; color: #777;">Click calculate to see results</p>
            </div>
        </div>
    </div>
    
    <div style="display: flex; justify-content: center; margin: 20px auto; align-items: center; gap: 10px;">
        <label for="language" style="width: auto; margin: 0; flex: 0 0 auto;">Language:</label>
        <select id="language" onchange="changeLanguage()" style="width: 100px; flex: 0 0 100px;">
            <option value="en">English</option>
            <option value="zh">中文</option>
        </select>
    </div>

    <script>
        const languages = {
            en: {
                title: "Time Difference Calculator",
                resultsTitle: "Overlap Results",
                yourTimezone: "Your Timezone",
                yourStart: "Free Start",
                yourEnd: "Free End",
                otherTimezone: "Other's Timezone",
                otherStart: "Free Start",
                otherEnd: "Free End",
                calculate: "Calculate Overlap",
                fillAllTimes: "Please fill in all time fields.",
                noOverlap: "No overlapping free time found.",
                invalidTime: "Start time must be earlier than end time.",
                overlappingTimes: "Total Overlap:",
                inYourTimezone: "In Your Timezone",
                inOtherTimezone: "In Other's Timezone",
                yourFreeTime: "Your Schedule",
                otherFreeTime: "Other's Schedule (Converted)",
                language: "Language",
                hours: "hrs",
                minutes: "mins"
            },
            zh: {
                title: "时差与重叠时间计算",
                resultsTitle: "计算结果",
                yourTimezone: "你的时区",
                yourStart: "空闲开始",
                yourEnd: "空闲结束",
                otherTimezone: "对方时区",
                otherStart: "空闲开始",
                otherEnd: "空闲结束",
                calculate: "计算重叠时间",
                fillAllTimes: "请填写完整的时间信息。",
                noOverlap: "很遗憾，没有重叠的空闲时间。",
                invalidTime: "开始时间必须早于结束时间。",
                overlappingTimes: "重叠时长:",
                inYourTimezone: "你的当地时间",
                inOtherTimezone: "对方当地时间",
                yourFreeTime: "你的时间轴",
                otherFreeTime: "对方时间轴 (换算后)",
                language: "语言",
                hours: "小时",
                minutes: "分钟"
            }
        };

        const tzDescriptions = {
            '-12': { en: 'Baker Island', zh: '贝克岛 (UTC-12)' },
            '-11': { en: 'Samoa', zh: '萨摩亚 (UTC-11)' },
            '-10': { en: 'Hawaii (USA)', zh: '美国夏威夷 (UTC-10)' },
            '-9': { en: 'Alaska (Winter)', zh: '美国阿拉斯加 (冬令时)' },
            '-8': { en: 'Pacific (Winter) / Alaska (Summer)', zh: '美国太平洋 (冬令时) / 阿拉斯加 (夏)' },
            '-7': { en: 'Mountain (Winter) / Pacific (Summer)', zh: '美国山地 (冬令时) / 太平洋 (夏)' },
            '-6': { en: 'Central (Winter) / Mountain (Summer)', zh: '美国中部 (冬令时) / 山地 (夏)' },
            '-5': { en: 'Eastern (Winter) / Central (Summer)', zh: '美国东部 (冬令时) / 中部 (夏)' },
            '-4': { en: 'Atlantic / Eastern (Summer)', zh: '大西洋 / 美国东部 (夏)' },
            '-3': { en: 'Argentina / Brazil', zh: '阿根廷 / 巴西' },
            '-2': { en: 'Mid-Atlantic', zh: '中大西洋' },
            '-1': { en: 'Azores', zh: '亚速尔群岛' },
            '0': { en: 'GMT (London Winter)', zh: '伦敦 (冬令时)' },
            '1': { en: 'CET (Europe Winter) / UK Summer', zh: '欧洲中部 (冬) / 英国 (夏)' },
            '2': { en: 'EET (Europe Winter) / CET Summer', zh: '欧洲东部 (冬) / 欧洲中部 (夏)' },
            '3': { en: 'Moscow / EET Summer', zh: '莫斯科 / 欧洲东部 (夏)' },
            '4': { en: 'Dubai', zh: '迪拜' },
            '5': { en: 'Pakistan', zh: '巴基斯坦' },
            '5.5': { en: 'India (IST)', zh: '印度标准时间' },
            '6': { en: 'Bangladesh', zh: '孟加拉国' },
            '7': { en: 'Thailand / Vietnam', zh: '泰国 / 越南' },
            '8': { en: 'China / Singapore', zh: '中国 (北京) / 新加坡' },
            '9': { en: 'Japan / Korea', zh: '日本 / 韩国' },
            '10': { en: 'Sydney (Winter)', zh: '悉尼 (冬令时)' },
            '11': { en: 'Sydney (Summer)', zh: '悉尼 (夏令时)' },
            '12': { en: 'New Zealand', zh: '新西兰' }
        };
        
        let currentLang = 'zh';

        function createOption(value, text, isSelected) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            if (isSelected) option.selected = true;
            return option;
        }

        function getTimezonesArray() {
            const arr = [];
            for (let i = -12; i <= 12; i++) {
                const sign = i >= 0 ? '+' : '';
                arr.push(`UTC${sign}${i}`);
            }
            return arr;
        }

        function populateTimezones() {
            const mySelect = document.getElementById('myTimezone');
            const otherSelect = document.getElementById('otherTimezone');
            
            const currentMy = mySelect.value || 'UTC+8';
            const currentOther = otherSelect.value || 'UTC-5';
            
            mySelect.innerHTML = '';
            otherSelect.innerHTML = '';

            const timezones = getTimezonesArray();

            timezones.forEach(tz => {
                const offset = parseInt(tz.replace('UTC', ''));
                const desc = tzDescriptions[offset.toString()] || { en: '', zh: '' };
                const location = currentLang === 'zh' ? desc.zh : desc.en;
                const label = location ? `${tz} ${location}` : tz;

                mySelect.appendChild(createOption(tz, label, tz === currentMy));
                otherSelect.appendChild(createOption(tz, label, tz === currentOther));
            });
        }
        
        function getBars(startMin, endMin) {
            const totalMinutes = 1440;
            if (startMin <= endMin) {
                return [{ left: (startMin / totalMinutes) * 100, width: ((endMin - startMin) / totalMinutes) * 100 }];
            } else {
                return [
                    { left: (startMin / totalMinutes) * 100, width: ((1440 - startMin) / totalMinutes) * 100 },
                    { left: 0, width: (endMin / totalMinutes) * 100 }
                ];
            }
        }
        
        function generateTimelineHTML(bars, className) {
            return `
                <div class="timeline">
                    ${bars.map(bar => `<div class="${className}" style="left: ${bar.left}%; width: ${bar.width}%;"></div>`).join('')}
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>
                </div>
            `;
        }
        
        function changeLanguage() {
            currentLang = document.getElementById('language').value;
            updateLanguage();
            populateTimezones();
            calculateOverlap();
        }
        
        function updateLanguage() {
            const lang = languages[currentLang];
            document.querySelector('.input-section h1').textContent = lang.title;
            document.querySelector('.result-section h2').textContent = lang.resultsTitle;
            document.getElementById('myTimezone').previousElementSibling.textContent = lang.yourTimezone;
            document.getElementById('myStart').previousElementSibling.textContent = lang.yourStart;
            document.getElementById('myEnd').previousElementSibling.textContent = lang.yourEnd;
            document.getElementById('otherTimezone').previousElementSibling.textContent = lang.otherTimezone;
            document.getElementById('otherStart').previousElementSibling.textContent = lang.otherStart;
            document.getElementById('otherEnd').previousElementSibling.textContent = lang.otherEnd;
            document.querySelector('button').textContent = lang.calculate;
            document.querySelector('label[for="language"]').textContent = lang.language;
        }
        
        function calculateOverlap() {
            const lang = languages[currentLang];
            const myTzValue = document.getElementById('myTimezone').value;
            const myStart = document.getElementById('myStart').value;
            const myEnd = document.getElementById('myEnd').value;
            const otherTzValue = document.getElementById('otherTimezone').value;
            const otherStart = document.getElementById('otherStart').value;
            const otherEnd = document.getElementById('otherEnd').value;
            
            if (!myStart || !myEnd || !otherStart || !otherEnd) {
                document.getElementById('result').innerHTML = `<p style="color: #d9534f;">${lang.fillAllTimes}</p>`;
                return;
            }
            
            const myStartMin = parseTimeToMin(myStart);
            const myEndMin = parseTimeToMin(myEnd);
            const otherStartMin = parseTimeToMin(otherStart);
            const otherEndMin = parseTimeToMin(otherEnd);
            
            if (myStartMin >= myEndMin) {
                document.getElementById('result').innerHTML = `<p style="color: #d9534f;">${lang.invalidTime} (${lang.yourFreeTime})</p>`;
                return;
            }
            if (otherStartMin >= otherEndMin) {
                document.getElementById('result').innerHTML = `<p style="color: #d9534f;">${lang.invalidTime} (${lang.otherFreeTime})</p>`;
                return;
            }
            
            const myOffset = parseInt(myTzValue.replace('UTC', ''));
            const otherOffset = parseInt(otherTzValue.replace('UTC', ''));
            const difference = otherOffset - myOffset; 
            
            let shiftedOtherStartMin = otherStartMin + difference * 60;
            let shiftedOtherEndMin = otherEndMin + difference * 60;
            
            shiftedOtherStartMin = ((shiftedOtherStartMin % 1440) + 1440) % 1440;
            shiftedOtherEndMin = ((shiftedOtherEndMin % 1440) + 1440) % 1440;
            
            let totalOverlapMin = 0;
            let overlapBars = [];
            
            if (shiftedOtherStartMin <= shiftedOtherEndMin) {
                const overlapStart = Math.max(myStartMin, shiftedOtherStartMin);
                const overlapEnd = Math.min(myEndMin, shiftedOtherEndMin);
                if (overlapStart < overlapEnd) {
                    totalOverlapMin = overlapEnd - overlapStart;
                    overlapBars.push({ left: (overlapStart / 1440) * 100, width: ((overlapEnd - overlapStart) / 1440) * 100 });
                }
            } else {
                const part1Start = shiftedOtherStartMin;
                const part1End = 1440;
                const part2Start = 0;
                const part2End = shiftedOtherEndMin;
                
                const overlap1Start = Math.max(myStartMin, part1Start);
                const overlap1End = Math.min(myEndMin, part1End);
                if (overlap1Start < overlap1End) {
                    totalOverlapMin += overlap1End - overlap1Start;
                    overlapBars.push({ left: (overlap1Start / 1440) * 100, width: ((overlap1End - overlap1Start) / 1440) * 100 });
                }
                
                const overlap2Start = Math.max(myStartMin, part2Start);
                const overlap2End = Math.min(myEndMin, part2End);
                if (overlap2Start < overlap2End) {
                    totalOverlapMin += overlap2End - overlap2Start;
                    overlapBars.push({ left: (overlap2Start / 1440) * 100, width: ((overlap2End - overlap2Start) / 1440) * 100 });
                }
            }
            
            const myTzText = document.getElementById('myTimezone').options[document.getElementById('myTimezone').selectedIndex].text;
            const otherTzText = document.getElementById('otherTimezone').options[document.getElementById('otherTimezone').selectedIndex].text;

            if (totalOverlapMin === 0) {
                const totalMinutes = 1440;
                const myLeft = (myStartMin / totalMinutes) * 100;
                const myWidth = ((myEndMin - myStartMin) / totalMinutes) * 100;
                const myBars = [{ left: myLeft, width: myWidth }];
                const otherBars = getBars(shiftedOtherStartMin, shiftedOtherEndMin);
                
                document.getElementById('result').innerHTML = `
                    <p style="font-weight: bold; color: #777;">${lang.noOverlap}</p>
                    
                    <p style="margin-top: 15px; margin-bottom: 5px;">${lang.yourFreeTime}</p>
                    ${generateTimelineHTML(myBars, 'free-my')}
                    
                    <p style="margin-top: 15px; margin-bottom: 5px;">${lang.otherFreeTime}</p>
                    ${generateTimelineHTML(otherBars, 'free-other')}
                `;
                return;
            }
            
            const overlapHours = totalOverlapMin / 60;
            const hours = Math.floor(overlapHours);
            const minutes = Math.round((overlapHours - hours) * 60);
            
            const periodsMy = overlapBars.map(bar => {
                const startMin = Math.round(bar.left * 1440 / 100);
                const endMin = Math.round((bar.left + bar.width) * 1440 / 100);
                return `${minToTime(startMin)} - ${minToTime(endMin)}`;
            });
            const overlapStartMy = periodsMy.join(', ');
            
            const periodsOther = overlapBars.map(bar => {
                let startOtherMin = Math.round(bar.left * 1440 / 100) - difference * 60;
                let endOtherMin = Math.round((bar.left + bar.width) * 1440 / 100) - difference * 60;
                startOtherMin = ((startOtherMin % 1440) + 1440) % 1440;
                endOtherMin = ((endOtherMin % 1440) + 1440) % 1440;
                return `${minToTime(startOtherMin)} - ${minToTime(endOtherMin)}`;
            });
            const overlapStartOther = periodsOther.join(', ');
            
            const totalMinutes = 1440;
            const myLeft = (myStartMin / totalMinutes) * 100;
            const myWidth = ((myEndMin - myStartMin) / totalMinutes) * 100;
            const otherBars = getBars(shiftedOtherStartMin, shiftedOtherEndMin);
            
            document.getElementById('result').innerHTML = `
                <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border: 1px solid #c3e6cb; margin-bottom: 20px;">
                    <p style="font-size: 1.1em; color: #2e7d32; margin: 0; line-height: 1.5;">
                        <strong>${lang.overlappingTimes} ${hours} ${lang.hours} ${minutes} ${lang.minutes}</strong>
                    </p>
                </div>
                
                <p><strong>${lang.inYourTimezone}:</strong> <br><span style="color: #666; font-size: 0.9em; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${myTzText}</span> <span style="font-size: 1.2em; color: blue;">${overlapStartMy}</span></p>
                <p><strong>${lang.inOtherTimezone}:</strong> <br><span style="color: #666; font-size: 0.9em; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${otherTzText}</span> <span style="font-size: 1.2em; color: red;">${overlapStartOther}</span></p>
                
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                
                <p style="margin-bottom: 5px;">${lang.yourFreeTime}</p>
                <div class="timeline">
                    <div class="free-my" style="left: ${myLeft}%; width: ${myWidth}%;"></div>
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>
                </div>
                
                <p style="margin-top: 20px; margin-bottom: 5px;">${lang.otherFreeTime}</p>
                <div class="timeline">
                    ${otherBars.map(bar => `<div class="free-other" style="left: ${bar.left}%; width: ${bar.width}%;"></div>`).join('')}
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>
                </div>
            `;
        }
        
        function parseTimeToMin(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function minToTime(min) {
            const hours = Math.floor(min / 60);
            const minutes = min % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        document.getElementById('language').value = currentLang;
        updateLanguage();
        populateTimezones();
    </script>
</body>
</html>