<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Difference Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f8f9fa; }
        .app { display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; }
        .input-section { flex: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .result-section { flex: 1; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .input-group { margin-bottom: 10px; display: flex; align-items: center; justify-content: center; }
        label { display: inline-block; width: 200px; text-align: right; margin-right: 10px; font-weight: bold; }
        select, input { width: 100px; padding: 6px; font-size: 14px; }
        button { padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer; width: 100%; font-size: 16px; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; }
        .timeline {
            position: relative;
            width: 100%;
            height: 30px;
            background: #ddd;
            margin: 10px 0;
            border-radius: 5px;
        }
        .timeline .free-my {
            position: absolute;
            height: 100%;
            background: blue;
            border-radius: 5px;
        }
        .timeline .free-other {
            position: absolute;
            height: 100%;
            background: red;
            border-radius: 5px;
        }
        .timeline-labels {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-top: 2px;
        }
        
        @media (max-width: 768px) {
            .app {
                flex-direction: column;
                gap: 20px;
            }
            .input-section, .result-section {
                padding: 15px;
            }
            label {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="input-section">
            <h1 style="text-align: center; margin-bottom: 20px; color: #333;">Time Difference Calculator</h1>
            
            <div class="input-group">
                <label for="myTimezone">Your Timezone:</label>
                <select id="myTimezone"></select>
            </div>
            
            <div class="input-group">
                <label for="myStart">Your Free Time Start:</label>
                <input type="time" id="myStart">
            </div>
            
            <div class="input-group">
                <label for="myEnd">Your Free Time End:</label>
                <input type="time" id="myEnd">
            </div>
            
            <div class="input-group">
                <label for="otherTimezone">Other's Timezone:</label>
                <select id="otherTimezone"></select>
            </div>
            
            <div class="input-group">
                <label for="otherStart">Other's Free Time Start:</label>
                <input type="time" id="otherStart">
            </div>
            
            <div class="input-group">
                <label for="otherEnd">Other's Free Time End:</label>
                <input type="time" id="otherEnd">
            </div>
            
            <button onclick="calculateOverlap()">Calculate Overlap</button>
        </div>
        
        <div class="result-section">
            <h2 style="text-align: center; margin-bottom: 20px; color: #333;">Results</h2>
            <div id="result"></div>
        </div>
    </div>
    
    <div style="display: flex; justify-content: center; margin: 10px auto;">
        <label for="language">Language:</label>
        <select id="language" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="zh">中文</option>
        </select>
    </div>

    <script>
        // Helper functions
        function createOption(tz, isSelected) {
            const option = document.createElement('option');
            option.value = tz;
            option.textContent = tz;
            if (isSelected) option.selected = true;
            return option;
        }
        
        function getBars(startMin, endMin) {
            const totalMinutes = 1440;
            if (startMin <= endMin) {
                return [{ left: (startMin / totalMinutes) * 100, width: ((endMin - startMin) / totalMinutes) * 100 }];
            } else {
                return [
                    { left: (startMin / totalMinutes) * 100, width: ((1440 - startMin) / totalMinutes) * 100 },
                    { left: 0, width: (endMin / totalMinutes) * 100 }
                ];
            }
        }
        
        function generateTimelineHTML(bars, className) {
            return `
                <div class="timeline">
                    ${bars.map(bar => `<div class="${className}" style="left: ${bar.left}%; width: ${bar.width}%;"></div>`).join('')}
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>
                </div>
            `;
        }
        
        // Language support
        const languages = {
            en: {
                title: "Time Difference Calculator",
                resultsTitle: "Results",
                yourTimezone: "Your Timezone:",
                yourStart: "Your Free Time Start:",
                yourEnd: "Your Free Time End:",
                otherTimezone: "Other's Timezone:",
                otherStart: "Other's Free Time Start:",
                otherEnd: "Other's Free Time End:",
                calculate: "Calculate Overlap",
                fillAllTimes: "Please fill in all times.",
                noOverlap: "No overlapping time.",
                invalidTime: "Start time must be before end time.",
                overlappingTimes: "Overlapping times:",
                inYourTimezone: "In your timezone",
                inOtherTimezone: "In other's timezone",
                yourFreeTime: "Your free time:",
                otherFreeTime: "Other's free time (shifted to your timezone):",
                language: "Language:",
                hours: "hours",
                minutes: "minutes"
            },
            zh: {
                title: "时差计算器",
                resultsTitle: "结果",
                yourTimezone: "你的时区:",
                yourStart: "你的空闲时间开始:",
                yourEnd: "你的空闲时间结束:",
                otherTimezone: "对方的时区:",
                otherStart: "对方的空闲时间开始:",
                otherEnd: "对方的空闲时间结束:",
                calculate: "计算重叠",
                fillAllTimes: "请填写所有时间。",
                noOverlap: "没有重叠时间。",
                invalidTime: "开始时间必须在结束时间之前。",
                overlappingTimes: "重叠时间:",
                inYourTimezone: "在你的时区",
                inOtherTimezone: "在对方的时区",
                yourFreeTime: "你的空闲时间:",
                otherFreeTime: "对方的空闲时间（转换到你的时区）:",
                language: "语言:",
                hours: "小时",
                minutes: "分钟"
            }
        };
        
        let currentLang = 'en';
        
        function changeLanguage() {
            currentLang = document.getElementById('language').value;
            updateLanguage();
            // Always refresh to update any displayed messages
            calculateOverlap();
        }
        
        function updateLanguage() {
            const lang = languages[currentLang];
            document.querySelector('.input-section h1').textContent = lang.title;
            document.querySelector('.result-section h2').textContent = lang.resultsTitle;
            document.getElementById('myTimezone').previousElementSibling.textContent = lang.yourTimezone;
            document.getElementById('myStart').previousElementSibling.textContent = lang.yourStart;
            document.getElementById('myEnd').previousElementSibling.textContent = lang.yourEnd;
            document.getElementById('otherTimezone').previousElementSibling.textContent = lang.otherTimezone;
            document.getElementById('otherStart').previousElementSibling.textContent = lang.otherStart;
            document.getElementById('otherEnd').previousElementSibling.textContent = lang.otherEnd;
            document.querySelector('button').textContent = lang.calculate;
            document.querySelector('label[for="language"]').textContent = lang.language;
        }
        
        // Populate timezone options
        const timezones = [
            'UTC-12', 'UTC-11', 'UTC-10', 'UTC-9', 'UTC-8', 'UTC-7', 'UTC-6', 'UTC-5',
            'UTC-4', 'UTC-3', 'UTC-2', 'UTC-1', 'UTC+0', 'UTC+1', 'UTC+2', 'UTC+3',
            'UTC+4', 'UTC+5', 'UTC+6', 'UTC+7', 'UTC+8', 'UTC+9', 'UTC+10', 'UTC+11', 'UTC+12'
        ];
        
        const myTimezoneSelect = document.getElementById('myTimezone');
        const otherTimezoneSelect = document.getElementById('otherTimezone');
        
        timezones.forEach(tz => {
            myTimezoneSelect.appendChild(createOption(tz, tz === 'UTC+8'));
            otherTimezoneSelect.appendChild(createOption(tz, tz === 'UTC-4'));
        });
        
        // Initialize language
        updateLanguage();
        
        function calculateOverlap() {
            const lang = languages[currentLang];
            const myTz = document.getElementById('myTimezone').value;
            const myStart = document.getElementById('myStart').value;
            const myEnd = document.getElementById('myEnd').value;
            const otherTz = document.getElementById('otherTimezone').value;
            const otherStart = document.getElementById('otherStart').value;
            const otherEnd = document.getElementById('otherEnd').value;
            
            if (!myStart || !myEnd || !otherStart || !otherEnd) {
                document.getElementById('result').innerHTML = lang.fillAllTimes;
                return;
            }
            
            // Validate time ranges
            const myStartMin = parseTimeToMin(myStart);
            const myEndMin = parseTimeToMin(myEnd);
            const otherStartMin = parseTimeToMin(otherStart);
            const otherEndMin = parseTimeToMin(otherEnd);
            
            if (myStartMin >= myEndMin) {
                document.getElementById('result').innerHTML = `<p>${lang.invalidTime} (${lang.yourFreeTime})</p>`;
                return;
            }
            if (otherStartMin >= otherEndMin) {
                document.getElementById('result').innerHTML = `<p>${lang.invalidTime} (${lang.otherFreeTime})</p>`;
                return;
            }
            
            // Get offsets
            const myOffset = parseInt(myTz.replace('UTC', ''));
            const otherOffset = parseInt(otherTz.replace('UTC', ''));
            const difference = otherOffset - myOffset; // hours
            
            // Shift other's time to my timezone
            let shiftedOtherStartMin = otherStartMin + difference * 60;
            let shiftedOtherEndMin = otherEndMin + difference * 60;
            
            // Adjust for day wrap-around
            shiftedOtherStartMin = ((shiftedOtherStartMin % 1440) + 1440) % 1440;
            shiftedOtherEndMin = ((shiftedOtherEndMin % 1440) + 1440) % 1440;
            
            // Find overlap in my timezone
            let totalOverlapMin = 0;
            let overlapBars = [];
            if (shiftedOtherStartMin <= shiftedOtherEndMin) {
                const overlapStart = Math.max(myStartMin, shiftedOtherStartMin);
                const overlapEnd = Math.min(myEndMin, shiftedOtherEndMin);
                if (overlapStart < overlapEnd) {
                    totalOverlapMin = overlapEnd - overlapStart;
                    overlapBars.push({ left: (overlapStart / 1440) * 100, width: ((overlapEnd - overlapStart) / 1440) * 100 });
                }
            } else {
                // Crosses midnight
                const part1Start = shiftedOtherStartMin;
                const part1End = 1440;
                const part2Start = 0;
                const part2End = shiftedOtherEndMin;
                
                const overlap1Start = Math.max(myStartMin, part1Start);
                const overlap1End = Math.min(myEndMin, part1End);
                if (overlap1Start < overlap1End) {
                    totalOverlapMin += overlap1End - overlap1Start;
                    overlapBars.push({ left: (overlap1Start / 1440) * 100, width: ((overlap1End - overlap1Start) / 1440) * 100 });
                }
                
                const overlap2Start = Math.max(myStartMin, part2Start);
                const overlap2End = Math.min(myEndMin, part2End);
                if (overlap2Start < overlap2End) {
                    totalOverlapMin += overlap2End - overlap2Start;
                    overlapBars.push({ left: (overlap2Start / 1440) * 100, width: ((overlap2End - overlap2Start) / 1440) * 100 });
                }
            }
            
            if (totalOverlapMin === 0) {
                // Calculate timeline positions
                const totalMinutes = 1440;
                const myLeft = (myStartMin / totalMinutes) * 100;
                const myWidth = ((myEndMin - myStartMin) / totalMinutes) * 100;
                const myBars = [{ left: myLeft, width: myWidth }];
                const otherBars = getBars(shiftedOtherStartMin, shiftedOtherEndMin);
                
                document.getElementById('result').innerHTML = `
                    <p>${lang.noOverlap}</p>
                    <p>${lang.yourFreeTime}</p>
                    ${generateTimelineHTML(myBars, 'free-my')}
                    <p>${lang.otherFreeTime}</p>
                    ${generateTimelineHTML(otherBars, 'free-other')}
                `;
                return;
            }
            
            const overlapHours = totalOverlapMin / 60;
            const hours = Math.floor(overlapHours);
            const minutes = Math.round((overlapHours - hours) * 60);
            
            // Generate period strings
            const periodsMy = overlapBars.map(bar => {
                const startMin = Math.round(bar.left * 1440 / 100);
                const endMin = Math.round((bar.left + bar.width) * 1440 / 100);
                return `${minToTime(startMin)} - ${minToTime(endMin)}`;
            });
            const overlapStartMy = periodsMy.join(', ');
            
            const periodsOther = overlapBars.map(bar => {
                let startOtherMin = Math.round(bar.left * 1440 / 100) - difference * 60;
                let endOtherMin = Math.round((bar.left + bar.width) * 1440 / 100) - difference * 60;
                startOtherMin = ((startOtherMin % 1440) + 1440) % 1440;
                endOtherMin = ((endOtherMin % 1440) + 1440) % 1440;
                return `${minToTime(startOtherMin)} - ${minToTime(endOtherMin)}`;
            });
            const overlapStartOther = periodsOther.join(', ');
            
            // Calculate timeline positions
            const totalMinutes = 1440;
            const myLeft = (myStartMin / totalMinutes) * 100;
            const myWidth = ((myEndMin - myStartMin) / totalMinutes) * 100;
            
            const otherBars = getBars(shiftedOtherStartMin, shiftedOtherEndMin);
            
            document.getElementById('result').innerHTML = `
                <p>${lang.overlappingTimes} ${hours} ${lang.hours} ${minutes} ${lang.minutes}</p>
                <p>${lang.inYourTimezone} (${myTz}): ${overlapStartMy}</p>
                <p>${lang.inOtherTimezone} (${otherTz}): ${overlapStartOther}</p>
                <p>${lang.yourFreeTime}</p>
                <div class="timeline">
                    <div class="free-my" style="left: ${myLeft}%; width: ${myWidth}%;"></div>
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>
                </div>
                <p>${lang.otherFreeTime}</p>
                <div class="timeline">
                    ${otherBars.map(bar => `<div class="free-other" style="left: ${bar.left}%; width: ${bar.width}%;"></div>`).join('')}
                </div>
                <div class="timeline-labels">
                    <span>00:00</span>
                    <span>06:00</span>
                    <span>12:00</span>
                    <span>18:00</span>
                    <span>23:59</span>

            `;
        }
        
        function parseTimeToMin(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }
        
        function minToTime(min) {
            const hours = Math.floor(min / 60);
            const minutes = min % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }
    </script>
</body>
</html>